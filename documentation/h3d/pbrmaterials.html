<!DOCTYPE html>
<html lang="en" id="page"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width"/><title>PBR Materials - H3d  - Heaps.io Game Engine</title><base href="./../.."/>
<link href="css/styles.min.css" rel="stylesheet" type="text/css"/><link rel="canonical" href="http://heaps.io/documentation/h3d/pbrmaterials.html"/><link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed:300" rel="stylesheet"/><script src="js/jquery-3.3.1.min.js" type="text/javascript"></script><script src="js/JsTools.js" type="text/javascript"></script><meta name="description" content="Heaps has support for PBR (Physically Based Rendering) Materials. PBR Materials attempt to simulate lighting conditions more accurately than the default material types. PBR materials combine with your environment, lighting and renderer to create realistic looking materials. The material look is derived from 3 properties - the material color, roughness and metallic. Those properties combined with modifications to the environment and lighting power and renderer exposure are what creates a stunning and realistic look."/>
<meta name="twitter:creator" content="@ncanasse"/>
<meta property="og:title" content="PBR Materials - H3d  - Heaps.io Game Engine"/><meta property="og:description" content="Heaps has support for PBR (Physically Based Rendering) Materials. PBR Materials attempt to simulate lighting conditions more accurately than the default material types. PBR materials combine with your environment, lighting and renderer to create realistic looking materials. The material look is derived from 3 properties - the material color, roughness and metallic. Those properties combined with modifications to the environment and lighting power and renderer exposure are what creates a stunning and realistic look."/><meta property="og:type" content="website"/><meta property="og:url" content="http://heaps.io/documentation/h3d/pbrmaterials.html"/><meta property="og:image" content="http://heaps.io//img/share.png"/>    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en"/></head><body><a href="https://github.com/HeapsIO/" class="fork-button"><img src="img/fork-on-github.png" alt="Fork Heaps on GitHub"/></a><main><header class="header-page"><a class="mobileMenu" href="#"><img src="img/menu.png" alt="Menu"/> </a><nav class="top-nav"><a href="index.html" class="button ">Home</a><a href="about.html" class="button ">About</a><a href="samples/" class="button ">Samples</a><a href="documentation/getting-started/" class="button disabled">Online handbook</a><a href="api/" class="button">API</a><a href="https://gitter.im/heapsio/Lobby" class="button" target="_blank">Community</a></nav><div class="logo"><a href="./"><img src="img/logo.svg"/></a></div></header> <div class="row container"><nav class="col-4 sidebar"><ul class="unstyled"><li><a href="documentation/getting-started/">Getting started</a></li><li><a href="documentation/h2d/">H2d</a></li><li class="active"><a href="documentation/h3d/">H3d</a><ul><li><a href="documentation/h3d/events-and-interactivity.html">Events and interaction</a></li><li><a href="documentation/h3d/fbx-models.html">FBX Models</a></li><li><a href="documentation/h3d/gpuparticles.html">GPU Particles</a></li><li><a href="documentation/h3d/lights.html">Lights</a></li><li><a href="documentation/h3d/materials.html">Material Basics</a></li><li><a href="documentation/h3d/multipass-explained.html">Multipass explained</a></li><li class="current"><a href="documentation/h3d/pbrmaterials.html">PBR Materials</a></li><li><a href="documentation/h3d/scene-and-camera.html">Scenes and camera</a></li><li><a href="documentation/h3d/shadows.html">Shadows</a></li><li><a href="documentation/h3d/worldbatching.html">World Batching</a></li></ul></li><li><a href="documentation/hxd/">Hxd</a></li><li><a href="documentation/shaders/">Shaders</a></li><li><a href="documentation/target-platforms/">Target platforms</a></li><li><a href="documentation/tools/">Tools</a></li></ul></nav><article class="col-8 documentation"><div class="content"><h1><span>H3d</span> PBR Materials </h1><p>Heaps has support for PBR (Physically Based Rendering) Materials. PBR Materials attempt to simulate lighting conditions more accurately than the default material types. PBR materials combine with your environment, lighting and renderer to create realistic looking materials. The material look is derived from 3 properties - the material color, roughness and metallic. Those properties combined with modifications to the environment and lighting power and renderer exposure are what creates a stunning and realistic look.</p>
<p>*Note that PBR Materials are currently supported in HashLink and Browsers supporting WebGL 2.0 or later.</p>
<p>Let's dive into how to set up PBR Materials in heaps. Before we create our Heaps 3D scene we need to tell the engine that we want to use PBR Materials.</p>
<pre class="highlighted">
<span class="mtk4">//The following will automatically create a PBR Material renderer. </span>
<span class="mtk4">//It will also create the correct environment and </span>
<span class="mtk4">//lighting system that must be used for PBR materials.</span>
<span class="mtk1">h3d.mat.</span><span class="mtk9">MaterialSetup</span><span class="mtk1">.</span><span class="mtk17">current</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.mat.</span><span class="mtk9">PbrMaterialSetup</span><span class="mtk1">();</span>
</pre>
<p>Now we can start setting up our scene to work with PBR Materials. The first step is to create an environment map. PBR Materials don't explicitly need an 
environment map to function but creating one for this example will best showcase the realism of the materials.  The Heaps <a href="samples/pbr.html">PBR Example</a> has a good environment map to use.</p>
<pre class="highlighted">
<span class="mtk4">//Create a sphere that will be used for our Sky Sphere and the mesh of our PBR materials</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">sp</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.prim.</span><span class="mtk9">Sphere</span><span class="mtk1">(</span><span class="mtk8">1</span><span class="mtk1">, </span><span class="mtk8">128</span><span class="mtk1">, </span><span class="mtk8">128</span><span class="mtk1">);</span>
<span class="mtk4">//Make sure to add UVs and </span>
<span class="mtk17">sp</span><span class="mtk1">.</span><span class="mtk10">addNormals</span><span class="mtk1">();</span>
<span class="mtk17">sp</span><span class="mtk1">.</span><span class="mtk10">addUVs</span><span class="mtk1">();</span>

<span class="mtk4">//Create a background mesh </span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">bg</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.scene.</span><span class="mtk9">Mesh</span><span class="mtk1">(</span><span class="mtk17">sp</span><span class="mtk1">, </span><span class="mtk17">s3d</span><span class="mtk1">);</span>
<span class="mtk17">bg</span><span class="mtk1">.</span><span class="mtk10">scale</span><span class="mtk1">(</span><span class="mtk8">10</span><span class="mtk1">);</span>
<span class="mtk4">//Make sure it is always rendered</span>
<span class="mtk17">bg</span><span class="mtk1">.</span><span class="mtk17">material</span><span class="mtk1">.</span><span class="mtk17">mainPass</span><span class="mtk1">.</span><span class="mtk17">culling</span><span class="mtk1"> = </span><span class="mtk9">Front</span><span class="mtk1">;</span>
<span class="mtk17">bg</span><span class="mtk1">.</span><span class="mtk17">material</span><span class="mtk1">.</span><span class="mtk17">mainPass</span><span class="mtk1">.</span><span class="mtk10">setPassName</span><span class="mtk1">(</span><span class="mtk7">"overlay"</span><span class="mtk1">);</span>

<span class="mtk4">//Create an environment map texture</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">envMap</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.mat.</span><span class="mtk9">Texture</span><span class="mtk1">(</span><span class="mtk8">512</span><span class="mtk1">, </span><span class="mtk8">512</span><span class="mtk1">, [</span><span class="mtk9">Cube</span><span class="mtk1">]);        </span>
<span class="mtk17">envMap</span><span class="mtk1">.</span><span class="mtk17">name</span><span class="mtk1"> = </span><span class="mtk7">"envMap"</span><span class="mtk1">;</span>
<span class="mtk5">inline</span><span class="mtk1"> </span><span class="mtk5">function</span><span class="mtk1"> </span><span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk17">face</span><span class="mtk1">:</span><span class="mtk9">Int</span><span class="mtk1">, </span><span class="mtk17">res</span><span class="mtk1">:hxd.res.</span><span class="mtk9">Image</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">pix</span><span class="mtk1"> = </span><span class="mtk17">res</span><span class="mtk1">.</span><span class="mtk10">getPixels</span><span class="mtk1">();</span>
<span class="mtk1">    </span><span class="mtk17">envMap</span><span class="mtk1">.</span><span class="mtk10">uploadPixels</span><span class="mtk1">(</span><span class="mtk17">pix</span><span class="mtk1">, </span><span class="mtk8">0</span><span class="mtk1">, </span><span class="mtk17">face</span><span class="mtk1">);</span>
<span class="mtk1">}</span>
<span class="mtk4">//Set the faces for the environment cube map</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">0</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">front</span><span class="mtk1">);</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">1</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">back</span><span class="mtk1">);</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">2</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">right</span><span class="mtk1">);</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">3</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">left</span><span class="mtk1">);</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">4</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">top</span><span class="mtk1">);</span>
<span class="mtk10">set</span><span class="mtk1">(</span><span class="mtk8">5</span><span class="mtk1">, hxd.</span><span class="mtk9">Res</span><span class="mtk1">.</span><span class="mtk17">bottom</span><span class="mtk1">);</span>

<span class="mtk4">//Create a new environment that we can use to control some of the material behavior</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">env</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.scene.pbr.</span><span class="mtk9">Environment</span><span class="mtk1">(</span><span class="mtk17">envMap</span><span class="mtk1">);</span>
<span class="mtk17">env</span><span class="mtk1">.</span><span class="mtk10">compute</span><span class="mtk1">();</span>

<span class="mtk4">//Set the environment on the custom PBR renderer</span>
<span class="mtk17">renderer</span><span class="mtk1"> = </span><span class="mtk5">cast</span><span class="mtk1">(</span><span class="mtk17">s3d</span><span class="mtk1">.</span><span class="mtk17">renderer</span><span class="mtk1">, h3d.scene.pbr.</span><span class="mtk9">Renderer</span><span class="mtk1">);</span>
<span class="mtk17">renderer</span><span class="mtk1">.</span><span class="mtk17">env</span><span class="mtk1"> = </span><span class="mtk17">env</span><span class="mtk1">;</span>

<span class="mtk4">//Finally create a shader and apply it to the background mesh so we can actually render our environment on screen.   </span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">cubeShader</span><span class="mtk1"> = </span><span class="mtk17">bg</span><span class="mtk1">.</span><span class="mtk17">material</span><span class="mtk1">.</span><span class="mtk17">mainPass</span><span class="mtk1">.</span><span class="mtk10">addShader</span><span class="mtk1">(</span><span class="mtk5">new</span><span class="mtk1"> h3d.shader.pbr.</span><span class="mtk9">CubeLod</span><span class="mtk1">(</span><span class="mtk17">env</span><span class="mtk1">.</span><span class="mtk17">env</span><span class="mtk1">));</span>
</pre>
<p>At this point your scene should just have a Sky Sphere with nothing else in it but it is now ready to start working with PBR materials. Thankfully there's not too much else to do to get working with PBR Materials. The first step is to create a light.  PBR Materials use custom lights so you need to make sure that you use lights from the 'h3d.scene.pbr' package.</p>
<pre class="highlighted">
<span class="mtk4">//Create a point light - note that it's from the PBR package.</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">light</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.scene.pbr.</span><span class="mtk9">PointLight</span><span class="mtk1">(</span><span class="mtk17">s3d</span><span class="mtk1">);</span>
<span class="mtk17">light</span><span class="mtk1">.</span><span class="mtk10">setPos</span><span class="mtk1">(</span><span class="mtk8">30</span><span class="mtk1">, </span><span class="mtk8">10</span><span class="mtk1">, </span><span class="mtk8">40</span><span class="mtk1">);</span>
<span class="mtk17">light</span><span class="mtk1">.</span><span class="mtk17">range</span><span class="mtk1"> = </span><span class="mtk8">100</span><span class="mtk1">; </span>
<span class="mtk4">//Changing the power of the light will affect the look for your PBR materials.</span>
<span class="mtk17">light</span><span class="mtk1">.</span><span class="mtk17">power</span><span class="mtk1"> = </span><span class="mtk8">2</span><span class="mtk1">;</span>
</pre>
<p>Now that is done we are ready to actually render an object in our scene using PBR materials. For this example we will create a sphere and assign it some PBR material values.</p>
<pre class="highlighted">
<span class="mtk4">//Create a sphere using the same geometry from the Sky Sphere</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">sphere</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.scene.</span><span class="mtk9">Mesh</span><span class="mtk1">(</span><span class="mtk17">sp</span><span class="mtk1">, </span><span class="mtk17">s3d</span><span class="mtk1">);</span>

<span class="mtk4">//Create a shader to store our PBR values - note the first 2 parameters are 'metalness' and 'roughness'</span>
<span class="mtk5">var</span><span class="mtk1"> </span><span class="mtk17">pbrValues</span><span class="mtk1"> = </span><span class="mtk5">new</span><span class="mtk1"> h3d.shader.pbr.</span><span class="mtk9">PropsValues</span><span class="mtk1">(</span><span class="mtk8">1.0</span><span class="mtk1">,</span><span class="mtk8">0.5</span><span class="mtk1">,</span><span class="mtk8">0</span><span class="mtk1">);</span>

<span class="mtk4">//Assign the values to our sphere's materials</span>
<span class="mtk17">sphere</span><span class="mtk1">.</span><span class="mtk17">material</span><span class="mtk1">.</span><span class="mtk17">mainPass</span><span class="mtk1">.</span><span class="mtk10">addShader</span><span class="mtk1">(</span><span class="mtk17">pbrValues</span><span class="mtk1">);</span>
</pre>
<p>We've finally got something rendering with PBR materials! Your scene should look something like this.</p>
<p><img src="img/h3d/pbr_1.jpg" alt="Initial PBR Sphere"/></p>
<p>Now we can play with the values to get different looks. Lets reduce the roughness to 0.</p>
<pre class="highlighted">
<span class="mtk17">pbrValues</span><span class="mtk1">.</span><span class="mtk17">roughness</span><span class="mtk1"> = </span><span class="mtk8">0</span><span class="mtk1">;</span>
</pre>
<p>Now you can see that with no roughness the looks like it is made out of chrome.
<img src="img/h3d/pbr_norough.jpg" alt="PBR Sphere with no roughness"/></p>
<p>Let's now bring down the metallic to 0 as well</p>
<pre class="highlighted">
<span class="mtk17">pbrValues</span><span class="mtk1">.</span><span class="mtk17">metalness</span><span class="mtk1"> = </span><span class="mtk8">0</span><span class="mtk1">;</span>
</pre>
<p>Now you can see that with no roughness and no metallic the sphere looks like an extremely shiny piece of plastic.
<img src="img/h3d/pbr_norough_nometal.jpg" alt="PBR Sphere with no roughness"/></p>
<p>As you can tell simply by adjusting the metalness and roughness settings on the PBR Material you can dramatically change the look of your mesh.</p>
<h2>Exposure</h2>
<p>If you want to change the look of your materials you can also play with the exposure on the renderer.  The PBR renderer defaults to an exposure of 0 and reasonable values are between -3 and 3. Note that changing the exposure on your renderer will affect all of the materials in your scene.</p>
<pre class="highlighted">
<span class="mtk17">renderer</span><span class="mtk1"> = </span><span class="mtk5">cast</span><span class="mtk1">(</span><span class="mtk17">s3d</span><span class="mtk1">.</span><span class="mtk17">renderer</span><span class="mtk1">, h3d.scene.pbr.</span><span class="mtk9">Renderer</span><span class="mtk1">);</span>
<span class="mtk4">//Brighten up our PBR materials - this should not affect the environment</span>
<span class="mtk17">renderer</span><span class="mtk1">.</span><span class="mtk17">exposure</span><span class="mtk1"> = </span><span class="mtk8">1.5</span><span class="mtk1">; </span>
</pre><hr/><div class="contribution"><span class="contribution-link"><svg width="16" height="16" viewBox="0 0 1024 1024"><path fill="#222" d="M978.101 45.898c-28.77-28.768-67.018-44.611-107.701-44.611-40.685 0-78.933 15.843-107.701 44.611l-652.8 652.8c-2.645 2.645-4.678 5.837-5.957 9.354l-102.4 281.6c-3.4 9.347-1.077 19.818 5.957 26.85 4.885 4.888 11.43 7.499 18.104 7.499 2.933 0 5.891-0.502 8.744-1.541l281.6-102.4c3.515-1.28 6.709-3.312 9.354-5.958l652.8-652.8c28.768-28.768 44.613-67.018 44.613-107.702s-15.843-78.933-44.613-107.701zM293.114 873.883l-224.709 81.71 81.712-224.707 566.683-566.683 142.997 142.997-566.683 566.683zM941.899 225.098l-45.899 45.899-142.997-142.997 45.899-45.899c19.098-19.098 44.49-29.614 71.498-29.614s52.4 10.518 71.499 29.616c19.098 19.098 29.616 44.49 29.616 71.498s-10.52 52.4-29.616 71.498z"></path></svg><a href="https://github.com/HeapsIO/heaps.io/edit/master/./assets/content/documentation/H3d/PBRMaterials.md?message=Update:%20PBR Materials&amp;description=%0A%0ASources:%0A*%20http://heaps.io/documentation/h3d/pbrmaterials.html" rel="external">Edit Page</a></span><span class="contribution-link"><svg width="16" height="16" viewBox="0 0 1024 1024"><path fill="#222" d="M896 614.4h-77.544c-3.19-56.282-16.878-110.243-39.965-158.814 53.056-15.624 91.909-64.739 91.909-122.786 0-14.138-11.461-25.6-25.6-25.6s-25.6 11.462-25.6 25.6c0 38.984-29.205 71.254-66.88 76.138-8.928-13.632-18.678-26.68-29.259-39.026-5.515-6.435-11.203-12.6-17.032-18.525 7.147-22.477 10.771-45.877 10.771-69.787 0-127.043-103.357-230.4-230.4-230.4s-230.4 103.357-230.4 230.4c0 23.909 3.624 47.309 10.77 69.787-5.829 5.923-11.515 12.090-17.032 18.525-10.582 12.346-20.331 25.394-29.259 39.026-37.674-4.883-66.878-37.154-66.878-76.138 0-14.138-11.462-25.6-25.6-25.6s-25.6 11.462-25.6 25.6c0 58.046 38.853 107.162 91.907 122.784-23.086 48.573-36.773 102.534-39.965 158.816h-77.542c-14.138 0-25.6 11.461-25.6 25.6s11.462 25.6 25.6 25.6h77.544c3.19 56.283 16.878 110.243 39.965 158.816-53.056 15.622-91.909 64.738-91.909 122.784 0 14.139 11.462 25.6 25.6 25.6s25.6-11.461 25.6-25.6c0-38.984 29.205-71.254 66.88-76.138 8.928 13.632 18.677 26.68 29.259 39.026 62.965 73.458 147.013 113.912 236.661 113.912s173.698-40.454 236.661-113.912c10.581-12.346 20.331-25.394 29.258-39.026 37.677 4.883 66.882 37.152 66.882 76.138 0 14.139 11.461 25.6 25.6 25.6s25.6-11.461 25.6-25.6c0-58.046-38.853-107.163-91.907-122.784 23.086-48.571 36.773-102.533 39.965-158.816h77.542c14.139 0 25.6-11.461 25.6-25.6s-11.461-25.6-25.6-25.6zM486.4 102.4c98.811 0 179.2 80.389 179.2 179.2 0 10.986-0.99 21.824-2.933 32.458-52.312-37.811-112.885-58.058-176.267-58.058s-123.955 20.246-176.267 58.058c-1.942-10.634-2.933-21.472-2.933-32.458 0-98.811 80.389-179.2 179.2-179.2zM204.8 640c0-173.306 112.678-316.072 256-331.41v662.821c-143.322-15.339-256-158.106-256-331.411zM512 971.411v-662.821c143.322 15.338 256 158.104 256 331.41s-112.678 316.072-256 331.411z"></path></svg><a href="https://github.com/HeapsIO/heaps.io/issues/new?title=Suggestion:%20PBR Materials&amp;body=%0A%0ASources:%0A*%20http://heaps.io/documentation/h3d/pbrmaterials.html%0A*%20https://github.com/HeapsIO/heaps.io/tree/master/./assets/content/documentation/H3d/PBRMaterials.md" rel="external">Report Suggestion</a></span></div></div></article></div></main><footer><div class="container row"><div class="col-5"><a href="./"><img src="img/logo.svg"/></a></div><div class="col-3 links"><h3>Heaps.io</h3><p>Heaps is an open source and multi-platform toolkit to create 2D and 3D games.</p><a href="documentation/getting-started">Download</a><a href="about.html">About</a><a href="api">API</a><a href="https://github.com/HeapsIO/">Contribute</a><a href="https://gitter.im/heapsio/Lobby">Community</a></div><div class="col-1">&nbsp;</div><div class="col-3 links"><h3>Haxe</h3><p>Haxe is an open source and cross-platform language and toolkit.</p><a href="https://www.haxe.org">About</a><a href="https://www.haxe.org/use-cases">Use cases</a><a href="https://haxe.org/documentation/introduction/">Learn</a><a href="https://www.haxe.org/foundation">Haxe foundation</a></div></div><div class="copyright">&copy; 2018 <a href="https://haxe.org/foundation/">Haxe Foundation</a>| <a href="https://github.com/HeapsIO/heaps.io/tree/master/./assets/content/documentation/H3d/PBRMaterials.md">Contribute to this page</a>| <a href="https://feathericons.com/" rel="nofollow">Feather open source icons</a></div></footer><script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" type="text/css" href="https://code.haxe.org/css/highlighter.min.css"/><script defer="defer" src="https://code.haxe.org/js/highlighter.js"></script></body></html>